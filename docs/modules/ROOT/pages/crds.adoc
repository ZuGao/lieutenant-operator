==== Controller: Tenant

* Responsible for the `Tenant`  kind
* Manages the `GitRepo`  object for the tenant configuration
* Admission webhook denies deletion of `Tenant` object when there are
still `Cluster` objects available referencing the Tenant object to be
deleted

.Object Example
[source,yaml]
--
apiVersion: syn.tools/v1alpha1
kind: Tenant
metadata:
  name: aezoo6
  namespace: syn-lieutenant
spec:
  displayName: Big Corp.
  gitRepoTemplate:
    spec:
      <GitRepoSpec>
---
apiVersion: syn.tools/v1alpha1
kind: Tenant
metadata:
  name: os3ce3
  namespace: syn-lieutenant
spec:
  displayName: Acme Corp. (Subtenant of Big Corp)
  tenantRef:
    name: aezoo6
  gitRepoURL: https://github.com/acmecorp/commodore-config.git
--

[cols=",",options="header",]
|===
a|
Field

a|
Description

|`spec.displayName` |Display name of the tenant.

|`spec.gitRepoURL` |Git repository storing the tenant configuration. If
this is set, no `gitRepoTemplate` is needed.

|`spec.gitRepoTemplate.spec` |Template for managing the `GitRepo`
object. If not set, no  `GitRepo` object will be created.
|===


==== Controller: Cluster Registry

Functionality:

* Responsible for the `Cluster`  kind
* Manages the `GitRepo` object for cluster configuration catalog
* (Manages `Proxy`  object for providing an Inlets server endpoint) later
* Stores the registration key and it's validity for initial Steward
bootstrapping
* Admission webhook denies creation of `Cluster` object when the
referenced `Tenant` object is not available

.Object Example
[source,yaml]
--
apiVersion: syn.tools/v1alpha1
kind: Cluster
metadata:
  name: ae3oso
  namespace: syn-lieutenant
  labels:
    syn.tools/tenant: aezoo6
spec:
  displayName: Big Corp. Production Cluster
  gitRepoTemplate:
    spec:
      <GitRepoSpec>
  tenantRef:
    name: aezoo6
  tokenLifetime: 4h
  facts:
    distribution: openshift3
    cloud: cloudscale
    region: rma1
status:
  bootstrapToken:
    token: sdaf445ftzzt
    valid: true
    validUntil: 2020-01-27 12:00
---
apiVersion: syn.tools/v1alpha1
kind: Cluster
metadata:
  name: etahv3
  namespace: syn-lieutenant
  labels:
    syn.tools/tenant: os3ce3
spec:
  displayName: Acme Corp. Dev Cluster
  gitRepoURL: https://github.com/acmecorp/gitops-mycluster.git
  tenantRef:
    name: os3ce3
  tokenLifetime: 4h
  facts:
    distribution: openshift4
    cloud: aws
    region: eu-west-1
status:
  bootstrapToken:
    token: sdaf445ftzzt
    valid: true
    validUntil: 2020-01-27 12:00
--

[cols=",",options="header",]
|===
a|
Field

a|
Description

|`metadata.labels.syn.tools/tenant` |Autosynced from `spec.tenantRef.name`. Helpful for label filtering.

|`spec.displayName` |Display name of cluster which could be different
from `metadata.name`. Allows cluster renaming should it be needed.

|`spec.gitRepoURL` |Git repository storing the cluster configuration
catalog. If this is set, no `gitRepoTemplate` is needed.

|`spec.gitRepoTemplate.spec` |Template for managing the `GitRepo`
object.

|`spec.tenantRef` |Reference to `Tenant` object the cluster belongs to. It needs to be in the same namespace as the cluster object.

|`spec.facts` |Key/value pairs of statically configured cluster facts
which do not change on a cluster.


|`spec.status.bootstrapToken` a|
This key is used only once for Steward to register.

* `token`: Token string
* `validUntil`: Validity
* `valid`: True or false.

When the initial registration is done, `spec.bootstrapToken.valid` will
be changed to `false`.

|===


==== Controller: Git Repository

* Responsible for the `GitRepo`  kind
* Manages Git repository on the configured remote (CRUD)
* Configures deploy keys on the remote Git repository
* It's always referenced to the `Tenant` as owner
* Admission webhook denies creation of `GitRepo` object when the
referenced `Tenant` object is not available

[source,yaml]
--
apiVersion: syn.tools/v1alpha1
kind: GitRepo
metadata:
  name: ohj4iu
  namespace: syn-lieutenant
  labels:
    syn.tools/tenant: aezoo6
spec:
  apiSecretRef:
    name: my-api-secret
  deployKeys:
    steward:
      type: ssh-ed25519
      key: AAAA...
      writeAccess: true
  path: bigcorp
  repoName: commodore-config
  tenantRef:
    name: aezoo6
status:
  phase: created
  type: GitHub
  url: https://github.com/bigcorp/commodore-config.git
--

[cols=",",options="header",]
|===
a|
Field

a|
Description

|`metadata.labels.syn.tools/tenant` |Autosynced from `spec.tenantRef.name`. Helpful for label filtering.

|`spec.apiSecretRef` a|
Reference to secret containing connection information:

* `endpoint`: URL to API endpoint
* `token`: API token

|`spec.deployKeys` a|
_Optional_ dict of SSH deploy keys. If not set, no deploy keys will be
configured.

* `<key>` Name for this key. "steward" is reserved to be used by Steward.
* `<key>.type`: SSH key type
* `<key>.key`: SSH key
* `<key>.writeAccess`: _Optional_. true or false. Default false

|`spec.path` |Path to Git repository

|`spec.repoName` |Name of Git repository

|`spec.tenantRef` |Reference to `Tenant` object the Git repository belongs to. It needs to be in the same namespace as the cluster object.

|`status.phase` a|
Updated by Operator with current phase. Can be:

* created
* failed
* unknown

There's no deleted phase as a deleted repo will be re-created on the next reconcile run.

|`status.type` a|
Autodiscovered Git repo type. Can be:

* GitLab
* GitHub
* Gitea

|`status.url` |Computed Git repository URL
|===

==== Controller: Proxy

tbd
